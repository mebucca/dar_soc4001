<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Procesamiento avanzado de Bases de Datos en R</title>
    <meta charset="utf-8" />
    <meta name="author" content="  Mauricio Bucca  Profesor Asistente, Sociología UC" />
    <script src="libs/header-attrs-2.24/header-attrs.js"></script>
    <link rel="stylesheet" href="gentle-r.css" type="text/css" />
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Procesamiento avanzado de Bases de Datos en R
]
.subtitle[
## Manipulación de bases de datos con tidyverse
]
.author[
### <br> Mauricio Bucca<br> Profesor Asistente, Sociología UC
]
.date[
### <a href="https://github.com/mebucca">github.com/mebucca</a>
]

---


## Recapitulación
&lt;br&gt;

- Funciones basales de R

- Manipulación de datos

- Workflow en R




---

## Hoy hablaremos de ...

- Universo `tidyverse`

  - Importar datos con `readr`
  
  - Bases de datos "modernas" con `tibble`
  
  - ordenar, seleccionar, filtrar con`dplyr`


---
class: fullscreen, left, middle, text-black
background-image: url("images/typewriter.jpg")

#tidy
#verse

---
## Tidyverse y R-base

.center[![](tidy.jpg)]

---
## Universo tidyverse


.center[![](images/tidyverse_packs.png)]


---
## El creador

.pull-left[
Hadley Wickham
![](images/hadley.jpg)
]

--

.pull-right[
Los usuarios lo agradecen ...
![](images/wickham_president.jpg)
]

---
## tidyverse, un modo de vida


.pull-left[
![](images/tidydress.png)
]

--

.pull-right[
![](images/tidyverse_shower.png)
]


---
class: fullscreen, left, middle, text-black
background-image: url("images/typewriter.jpg")

.huge[#Importar]
.huge[#datos]



---


## readr, haven, readxl y más

![read_data](images/readr.png)

---

## readr: cargar archivos .cvs


```r
library("readr") 

setwd("/Users/Mauricio/Library/Mobile Documents/com~apple~CloudDocs/Teaching/ISUC/2023_2_data_analysis_r/repo/slides/class_5")

# leer archivo csv
data_casen_csv &lt;- read_csv("sample_casen2017.csv")
```

--


```
##          folio region comuna pco1 sexo edad ecivil yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh
## 1 1.310510e+12     13  13105   10    2   15      8   150000      NA      NA   600000    600000   750000
## 2 7.102101e+11      7   7102    2    2   59      1   250000      NA      NA   392000    439331   689331
## 3 1.320110e+12     13  13201    1    2   33      8   150000   52500   78327    87417    146517   296517
## 4 1.320230e+12     13  13202    1    1   47      1   900000 1508333 1508333  2791666   2791666  3691666
##   yoprcor yoprcorh ytrabajocor ytrabajocorh ypchautcor     ypc ypchtrabajo esc educ depen
## 1      NA       NA          NA       600000     100000  125000      100000   9    3     2
## 2      NA       NA          NA       220000      98000  172333       55000   8    2    NA
## 3      NA       NA       52500        87417      21854   74129       21854   8    2    NA
## 4 1500000  1500000     1500000      1500000     930555 1230555      500000  13    6    NA
```

---

## readr: cargar archivos .dta (Stata)


```r
library("haven") 

setwd(
  "/Users/Mauricio/Library/Mobile Documents/com~apple~CloudDocs/Teaching/ISUC/2023_2_data_analysis_r/repo/slides/class_5"
  )

# leer archivo dta 
data_casen_dta &lt;- read_dta("sample_casen2017.dta", encoding = "latin1", .name_repair = "minimal")
```

--


```
##          folio region comuna pco1 sexo edad ecivil yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh
## 1 1.310510e+12     13  13105   10    2   15      8   150000      NA      NA   600000    600000   750000
## 2 7.102101e+11      7   7102    2    2   59      1   250000      NA      NA   392000    439331   689331
## 3 1.320110e+12     13  13201    1    2   33      8   150000   52500   78327    87417    146517   296517
## 4 1.320230e+12     13  13202    1    1   47      1   900000 1508333 1508333  2791666   2791666  3691666
##   yoprcor yoprcorh ytrabajocor ytrabajocorh ypchautcor     ypc ypchtrabajo esc educ depen
## 1      NA       NA          NA       600000     100000  125000      100000   9    3     2
## 2      NA       NA          NA       220000      98000  172333       55000   8    2    NA
## 3      NA       NA       52500        87417      21854   74129       21854   8    2    NA
## 4 1500000  1500000     1500000      1500000     930555 1230555      500000  13    6    NA
```

---
class: fullscreen, left, middle, text-black
background-image: url("images/typewriter.jpg")

.huge[#Tibble]
.huge[###(bases de datos)]

---
## tibble: una version moderna de data frames

&lt;br&gt;

.pull-left[
![tibble](images/tibble.png)
]

.pull-right[
Comparados con data frames:

- tibbles son "flojos": no transforman los datos en ningún modo.

- tibbles son "gruñones": reclaman por cualquier poblema, facilitando detectar errores. 

- tibbles son fácil de leer 
]


---

# Crear un tibble

.pull-left[

```r
library("tibble")

mytibble &lt;- 
 tibble(
        x=rep(c("A","B","C"),8),
        y=sample(1:10,size=24, replace = T), 
        z=factor(sample(letters,size=24))
        )

print(mytibble)
```
]

--

.pull-right[

```
## # A tibble: 24 × 3
##    x         y z    
##    &lt;chr&gt; &lt;int&gt; &lt;fct&gt;
##  1 A         9 v    
##  2 B         5 e    
##  3 C         6 z    
##  4 A        10 r    
##  5 B         9 k    
##  6 C         2 y    
##  7 A         9 t    
##  8 B         7 m    
##  9 C         8 f    
## 10 A        10 q    
## # ℹ 14 more rows
```
]

---

## Transformar un data frame en tibble

Para transformar un data frame en tibble usamos la función `as_tibble()`.
--
 Continuándo con el ejemplo anterior, así se ven los datos de la encuenta Casen 2017 en formato `data.frame()`:

--


```
##           folio region comuna pco1 sexo edad ecivil yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh
## 1  1.310510e+12     13  13105   10    2   15      8   150000      NA      NA   600000    600000   750000
## 2  7.102101e+11      7   7102    2    2   59      1   250000      NA      NA   392000    439331   689331
## 3  1.320110e+12     13  13201    1    2   33      8   150000   52500   78327    87417    146517   296517
## 4  1.320230e+12     13  13202    1    1   47      1   900000 1508333 1508333  2791666   2791666  3691666
## 5  9.103300e+11      9   9103    4    2   58      8    80000    1667    1667   501667    720823   800823
## 6  1.311310e+12     13  13113   13    2    1      8        0      NA      NA   781000    781000   781000
## 7  6.104300e+11      6   6104    1    1   42      8   100000  270000  270000   270000    270000   370000
## 8  8.305300e+11      8   8305    2    2   45      1   100000      NA   44109   362500    428791   528791
## 9  3.301107e+11      3   3301    1    2   27      8   150000  433333  433333   433333    433333   583333
## 10 6.117300e+11      6   6117    4    2   17      8   200000      NA      NA  1093750   1093750  1293750
## 11 6.303300e+11      6   6303    2    2   54      1   200000  270000  270000  1150000   1150000  1350000
## 12 1.310310e+12     13  13103    4    1   26      8   200000  455000  455000   905000    905000  1105000
## 13 1.311011e+12     13  13110   10    2    3      8   300000      NA      NA  1750000   1750000  2050000
## 14 1.311911e+12     13  13119    5    1   22      8   250000      NA   33157   100000    133157   383157
## 15 1.120110e+12     11  11201    4    2   16      8   500000      NA      NA  3136667   3202771  3702771
## 16 8.103102e+11      8   8103    4    1    3      8   300000      NA      NA  1206667   1206667  1506667
## 17 4.203101e+11      4   4203   14    2   21      8        0  400000  400000   870000    870000   870000
## 18 4.101101e+11      4   4101    5    1   52      8   300000      NA      NA    80000    197321   497321
## 19 1.360310e+12     13  13603    2    2   64      1   200000   90000   90000   440000    440000   640000
## 20 1.020130e+12     10  10201   13    2   20      8   200000      NA      NA   245000    274406   474406
## 21 1.330230e+12     13  13302    2    2   39      2   300000  800000  800000  1600000   1600000  1900000
## 22 1.310610e+12     13  13106    1    2   55      5   250000  170000  195000   570000    595000   845000
## 23 8.416101e+11     16  16301    2    2   51      1   100000      NA      NA   201667    322672   422672
## 24 9.103100e+11      9   9103    1    2   51      6    80000  100000  100000   510000    510000   590000
## 25 5.801107e+11      5   5801    1    1   43      1   250000 1100000 1100000  1100000   1100000  1350000
## 26 4.102112e+11      4   4102    1    1   39      1        0 1000000 1000000  1000000   1000000  1000000
## 27 3.301106e+11      3   3301    2    2   50      1   150090      NA      NA   904648    904648  1054738
## 28 6.101102e+11      6   6101    1    1   47      8   350000 1210000 1210000  1646667   1646667  1996667
## 29 1.010111e+12     10  10101    1    2   67      1   120000   40000  162391    90000    212391   332391
## 30 9.207200e+11      9   9207    1    1   42      1   100000  501833  501833   501833    545942   645942
## 31 1.330230e+12     13  13302   12    1   19      8        0  350000  350000  1210000   1347880  1347880
## 32 3.101117e+11      3   3101    4    1   18      8   300000      NA      NA   750000    750000  1050000
## 33 7.301112e+11      7   7301    4    2   11      8    80000      NA      NA   568333    597211   677211
## 34 5.801100e+11      5   5801    3    1   37      2        0  491667  491667   741667    741667   741667
## 35 1.410220e+12     14  14102    1    2   64      7   100000  110000  112606   110000    112606   212606
## 36 8.417300e+11     16  16304    5    2   42      8   100000  100000  118459   238750    377546   477546
## 37 8.402300e+11     16  16102    2    2   59      1   150000      NA      NA   133000    144738   294738
## 38 7.101111e+11      7   7101    2    2   39      2   150000  279167  286535   662500    691978   841978
## 39 1.101104e+11      1   1101    4    2   28      2   300000      NA   29406  1495000   1524406  1824406
## 40 1.310910e+12     13  13109    1    1   60      5   100000  323333  323333   323333    323333   423333
## 41 9.101112e+11      9   9101    2    2   68      1  1000000 1700000 1700000 14600000  14600000 15600000
## 42 1.010610e+12     10  10106    2    2   57      1    80000  140000  140000   257070    317658   397658
## 43 1.311610e+12     13  13116   10    1   14      8        0      NA      NA  1632417   1632417  1632417
##    yoprcor yoprcorh ytrabajocor ytrabajocorh ypchautcor     ypc ypchtrabajo esc educ depen
## 1       NA       NA          NA       600000     100000  125000      100000   9    3     2
## 2       NA       NA          NA       220000      98000  172333       55000   8    2    NA
## 3       NA       NA       52500        87417      21854   74129       21854   8    2    NA
## 4  1500000  1500000     1500000      1500000     930555 1230555      500000  13    6    NA
## 5       NA       NA        1667       501667      55741   88980       55741  12    5    NA
## 6       NA       NA          NA       781000     260333  260333      260333  NA    0    NA
## 7   270000   270000      270000       270000     270000  370000      270000   5    1    NA
## 8       NA       NA          NA       362500      72500  105758       72500   6    1    NA
## 9   430000   430000      433333       433333     216667  291667      216667  15    8    NA
## 10      NA       NA          NA      1093750     273438  323438      273438  12    5     2
## 11  270000   270000      270000      1150000     383333  450000      383333  11    3    NA
## 12  400000   400000      455000       905000     226250  276250      226250  14    7    NA
## 13      NA       NA          NA      1750000     218750  256250      218750  NA    0    NA
## 14      NA       NA          NA       100000      33333  127719       33333  12    5    NA
## 15      NA       NA          NA      2916667     784167  925693      729167  10    3     2
## 16      NA       NA          NA      1206667     301667  376667      301667  NA    0     3
## 17  300000   300000      400000       870000     435000  435000      435000  15    9    NA
## 18      NA       NA          NA        80000      16000   99464       16000   8    2    NA
## 19      NA       NA          NA        50000     110000  160000       12500   4    1    NA
## 20      NA       NA          NA       245000      61250  118602       61250  13    9     9
## 21  600000   600000      800000      1600000     400000  475000      400000  12    5    NA
## 22  170000   170000      170000       410000     142500  211250      102500  12    5    NA
## 23      NA       NA          NA       185000      50417  105668       46250   8    2    NA
## 24  100000   100000      100000       510000     170000  196667      170000   6    1    NA
## 25  850000   850000     1100000      1100000     275000  337500      275000  16    9    NA
## 26 1000000  1000000     1000000      1000000     250000  250000      250000  12    5    NA
## 27      NA       NA          NA       904648     226162  263685      226162   8    2    NA
## 28  990000   990000     1110000      1260000     329333  399333      252000  17   11    NA
## 29      NA       NA          NA        50000      18000   66478       10000   8    2    NA
## 30  500000   500000      501833       501833     125458  161486      125458   6    1    NA
## 31  350000   350000      350000      1210000     172857  192554      172857   8    2    NA
## 32      NA       NA          NA       750000     150000  210000      150000  13    7     9
## 33      NA       NA          NA       568333     142083  169303      142083  NA    1     2
## 34  470000   470000      491667       691667     370834  370834      345834  18   11    NA
## 35  110000   110000      110000       110000     110000  212606      110000  12    5    NA
## 36      NA       NA          NA         8750      59688  119387        2188   6    1    NA
## 37      NA       NA          NA            0      66500  147369           0   6    1    NA
## 38  275000   275000      279167       554167     165625  210495      138542  12    5    NA
## 39      NA       NA          NA       700000     249167  304068      116667  16    9    10
## 40  280000   280000      323333       323333     323333  423333      323333  13    6    NA
## 41 1000000  1000000     1000000     13000000    7300000 7800000     6500000  17   11    NA
## 42  140000   140000      140000       257070      64268   99415       64268   8    2    NA
## 43      NA       NA          NA      1632417     233202  233202      233202  NA    3     2
##  [ reached 'max' / getOption("max.print") -- omitted 21601 rows ]
```

---

## Transformar un data frame en tibble

Así se ven cuando los transformamos a `tibble`:

--


```r
as_tibble(data_casen_csv)
```

```
## # A tibble: 21,644 × 23
##          folio region comuna  pco1  sexo  edad ecivil yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh
##          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     1.31e12     13  13105    10     2    15      8   150000      NA      NA   600000    600000   750000
##  2     7.10e11      7   7102     2     2    59      1   250000      NA      NA   392000    439331   689331
##  3     1.32e12     13  13201     1     2    33      8   150000   52500   78327    87417    146517   296517
##  4     1.32e12     13  13202     1     1    47      1   900000 1508333 1508333  2791666   2791666  3691666
##  5     9.10e11      9   9103     4     2    58      8    80000    1667    1667   501667    720823   800823
##  6     1.31e12     13  13113    13     2     1      8        0      NA      NA   781000    781000   781000
##  7     6.10e11      6   6104     1     1    42      8   100000  270000  270000   270000    270000   370000
##  8     8.31e11      8   8305     2     2    45      1   100000      NA   44109   362500    428791   528791
##  9     3.30e11      3   3301     1     2    27      8   150000  433333  433333   433333    433333   583333
## 10     6.12e11      6   6117     4     2    17      8   200000      NA      NA  1093750   1093750  1293750
## # ℹ 21,634 more rows
## # ℹ 10 more variables: yoprcor &lt;dbl&gt;, yoprcorh &lt;dbl&gt;, ytrabajocor &lt;dbl&gt;, ytrabajocorh &lt;dbl&gt;,
## #   ypchautcor &lt;dbl&gt;, ypc &lt;dbl&gt;, ypchtrabajo &lt;dbl&gt;, esc &lt;dbl&gt;, educ &lt;dbl&gt;, depen &lt;dbl&gt;
```

---
class: fullscreen, left, middle, text-black
background-image: url("images/typewriter.jpg")

.huge[#Pipes]

---

## ¿Pipes? ¿Para qué?

Supongamos que queremos calcular el _promedio de  ingresos (redondeado a cero dígitos) para mujeres con 12 o menos años de escolaridad_. El código de R sería así:

--


```r
round(mean(data_casen_csv$ytotcor[(data_casen_csv$esc &lt;= 12 &amp; data_casen_csv$sexo == 2)], 
           na.rm = TRUE),0)
```

```
## [1] 221740
```

--

.pull-left[
Una alternativa no mucho mejor:


```r
sub_muestra &lt;- data_casen_csv$ytotcor[
  (data_casen_csv$esc &lt;= 12 &amp;
     data_casen_csv$sexo == 2)]
  
my_mean &lt;- mean(sub_muestra, 
                na.rm=TRUE)
  
round(my_mean,0)
```
]

.pull-right[
![scream](images/scream.gif)
]

---

.pull-left[
.huge[#magritte]
![](images/magritte.png)
]

.pull-right[
.huge[#magrittr]
![](images/magrittr.png)
]

&lt;br&gt;
&lt;br&gt;

#### El operador `%&gt;%` (pipe), contenido en el paquete `magrittr`, ofrece una solución a este problema

---

## ¿Cómo funciona `%&gt;%`?


```r
round(mean(data_casen_csv$ytotcor[(data_casen_csv$esc &lt;= 12 &amp; data_casen_csv$sexo == 2)], 
           na.rm = TRUE),0)
```

El código usado es un conjunto anidado de instrucciones con la siguiente estructura:

```
redondear(promediar(seleccionar_casos(seleccionar_variables(datos))))
```

El operador `%&gt;%` permite re-expresar estas instrucciones en un modo que resulta más simple de escribir y leer:

```
datos %&gt;% 
  seleccionar_variable() %&gt;% 
  seleccionar_casos() %&gt;% 
  promediar() %&gt;% 
  redondear()
```

---

## Una ilustración

.pull-left[
![scream](images/mario.gif)
]
.pull-right[
Simple:
```
Mario %&gt;% 
  find_hat() %&gt;% 
  pick_flower()
```
]

--

En el lenguaje basal de `R` esto sería:

```
pick_flower(find_hat(Mario))
```
---

## Consideraciones importantes 

- La "tubería" (pipeline) debe siempre comezar con un objeto. Es decir, las funciones deben aplicarse sobre un argumento. Por ejemplo, el siguiente código no tiene sentido:  

  
  ```r
  find_hat() %&gt;% Mario %&gt;% pick_flower()
  ```

&lt;br&gt;

- El order en que se aplicar las funciones importa. Por ejemplo, las siguientes lineas de código tienen los mismo elementos pero producirían resultados distintos:

.pull-left[
  
  ```r
  persona %&gt;% levantarse() %&gt;% 
    ducharse() %&gt;% vestirse()
  ```
]
.pull-right[ 
####resultado: persona en pie, vestida, seca
]

.pull-bottom[
.pull-left[
  
  ```r
  persona %&gt;% levantarse() %&gt;% 
    vestirse()  %&gt;% ducharse()
  ```
]
.pull-right[
####resultado: persona en pie, vestida, mojada
]
]

---
## ¿Pipes? ¿Para qué?

Retomando: queremos calcular el _promedio de  ingresos (redondeado a cero dígitos) para mujeres con 12 o menos años de escolaridad_. El código de R sería así:

--


```r
round(mean(data_casen_csv$ytotcor[(data_casen_csv$esc &lt;= 12 &amp; data_casen_csv$sexo == 2)], 
           na.rm = TRUE),0)
```

```
## [1] 221740
```

--

.pull-left[
Usando "pipes" en `tidyverse`:


```r
data_casen_csv %&gt;%
  filter(esc &lt;= 12 &amp; sexo == 2) %&gt;%
  with(mean(ytotcor, na.rm =T)) %&gt;%
  round(0)
```

```
## [1] 221740
```
]

.pull-right[
![](images/tenor.gif)
]

---

class: fullscreen, left, middle, text-black
background-image: url("images/typewriter.jpg")

.huge[#dplyr]

---

## dplyr: herramientas intuitivas para manipulación de datos

&lt;br&gt;

.pull-left[
  ![dplyr](images/dplyr.png)
]

.pull-right[
`dplyr` permite:

- ordenar datos

- filtrar casos 

- seleccionar variables

- crear y transformar variables

- agrupar datos

- crear resumen estadísticos
]


---
class: inverse, center, middle

.huge[
##dplyr::arrange()
]

---

## arrange: ordenación de datos

La función `arrange()` permite ordenar las observaciones de una base de datos en función de los valores de una o más variables, en orden ascendente o descendente.

Continuando con los datos de la encuesta Casen 2017, esta es la vista no-ordenada de los datos:

--


```r
as_tibble(data_casen_csv)
```

```
## # A tibble: 21,644 × 23
##          folio region comuna  pco1  sexo  edad ecivil yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh
##          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     1.31e12     13  13105    10     2    15      8   150000      NA      NA   600000    600000   750000
##  2     7.10e11      7   7102     2     2    59      1   250000      NA      NA   392000    439331   689331
##  3     1.32e12     13  13201     1     2    33      8   150000   52500   78327    87417    146517   296517
##  4     1.32e12     13  13202     1     1    47      1   900000 1508333 1508333  2791666   2791666  3691666
##  5     9.10e11      9   9103     4     2    58      8    80000    1667    1667   501667    720823   800823
##  6     1.31e12     13  13113    13     2     1      8        0      NA      NA   781000    781000   781000
##  7     6.10e11      6   6104     1     1    42      8   100000  270000  270000   270000    270000   370000
##  8     8.31e11      8   8305     2     2    45      1   100000      NA   44109   362500    428791   528791
##  9     3.30e11      3   3301     1     2    27      8   150000  433333  433333   433333    433333   583333
## 10     6.12e11      6   6117     4     2    17      8   200000      NA      NA  1093750   1093750  1293750
## # ℹ 21,634 more rows
## # ℹ 10 more variables: yoprcor &lt;dbl&gt;, yoprcorh &lt;dbl&gt;, ytrabajocor &lt;dbl&gt;, ytrabajocorh &lt;dbl&gt;,
## #   ypchautcor &lt;dbl&gt;, ypc &lt;dbl&gt;, ypchtrabajo &lt;dbl&gt;, esc &lt;dbl&gt;, educ &lt;dbl&gt;, depen &lt;dbl&gt;
```

---

## arrange: ordenación de datos

Supongamos que queremos orderar la base de datos por edad. Por defecto `arrange()` ordena los datos en orden ascendente.
 
--


```r
library("dplyr") 

data_casen_csv %&gt;% arrange(edad)
```

```
## # A tibble: 21,644 × 23
##          folio region comuna  pco1  sexo  edad ecivil yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh
##          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     5.80e11      5   5801     4     1     0      8        0      NA      NA  1491000   1491000  1491000
##  2     7.11e11      7   7106     4     1     0      8        0      NA   11091   414167    496807   496807
##  3     8.10e11      8   8101     4     1     0      8    80000      NA      NA   895000    895000   975000
##  4     1.02e12     10  10206    10     2     0      8   100000      NA   11091   341667    374940   474940
##  5     9.12e11      9   9120     4     2     0      8        0      NA      NA   400000    400000   400000
##  6     7.40e11      7   7401     4     2     0      8   280000      NA      NA  4200000   4200000  4480000
##  7     1.01e12     10  10104     4     1     0      8    80000    1667    1667    95001     95001   175001
##  8     1.24e12     12  12401     4     1     0      8   300000      NA      NA   300000    322182   622182
##  9     9.11e11      9   9109     4     2     0      8        0      NA   11091   320000    360641   360641
## 10     9.20e11      9   9201     4     1     0      8   150000      NA   11091   740000    784220   934220
## # ℹ 21,634 more rows
## # ℹ 10 more variables: yoprcor &lt;dbl&gt;, yoprcorh &lt;dbl&gt;, ytrabajocor &lt;dbl&gt;, ytrabajocorh &lt;dbl&gt;,
## #   ypchautcor &lt;dbl&gt;, ypc &lt;dbl&gt;, ypchtrabajo &lt;dbl&gt;, esc &lt;dbl&gt;, educ &lt;dbl&gt;, depen &lt;dbl&gt;
```


---

## arrange: ordenación de datos

Para ordenar los datos por edad, en orden descendente, usamos la función `arrange()` en combinación con la función `desc()`

--


```r
data_casen_csv %&gt;% arrange(desc(edad))
```

```
## # A tibble: 21,644 × 23
##          folio region comuna  pco1  sexo  edad ecivil yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh
##          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     1.10e11      1   1101     8     2   110      7   200000   60000   64932  1160000   1164932  1364932
##  2     1.31e12     13  13110     7     2   101      7   300000  270000  270000   540000    540000   840000
##  3     1.31e12     13  13114    13     2   101      7   800000  300000  300000  2400000   2433157  3233157
##  4     8.20e11      8   8202    14     2   101      7   150000  230000  230000   748333    748333   898333
##  5     1.01e12     10  10109     9     1    99      2   120000  321929  321929  1548512   1548512  1668512
##  6     1.31e12     13  13120     7     2    98      7   500000  276000  276000  1176000   1176000  1676000
##  7     5.11e11      5   5109     1     1    98      1   400000  800000  800000   800000    800000  1200000
##  8     9.20e11      9   9202     1     1    97      2   150000      NA  169000   350000    519000   669000
##  9     1.31e12     13  13123     1     1    97      7   800000 1233333 1233333  1233333   1233333  2033333
## 10     1.31e12     13  13102     1     2    97      1   350000   83000   87932   243000    252864   602864
## # ℹ 21,634 more rows
## # ℹ 10 more variables: yoprcor &lt;dbl&gt;, yoprcorh &lt;dbl&gt;, ytrabajocor &lt;dbl&gt;, ytrabajocorh &lt;dbl&gt;,
## #   ypchautcor &lt;dbl&gt;, ypc &lt;dbl&gt;, ypchtrabajo &lt;dbl&gt;, esc &lt;dbl&gt;, educ &lt;dbl&gt;, depen &lt;dbl&gt;
```

---

## arrange: ordenación de datos

También es posible ordenar los datos por más de una variable. Supongamos que queremos orderar la base de datos por genero y edad, en ese orden. 

--


```r
data_casen_csv %&gt;% arrange(sexo,edad)
```

```
## # A tibble: 21,644 × 23
##          folio region comuna  pco1  sexo  edad ecivil yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh
##          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     5.80e11      5   5801     4     1     0      8        0      NA      NA  1491000   1491000  1491000
##  2     7.11e11      7   7106     4     1     0      8        0      NA   11091   414167    496807   496807
##  3     8.10e11      8   8101     4     1     0      8    80000      NA      NA   895000    895000   975000
##  4     1.01e12     10  10104     4     1     0      8    80000    1667    1667    95001     95001   175001
##  5     1.24e12     12  12401     4     1     0      8   300000      NA      NA   300000    322182   622182
##  6     9.20e11      9   9201     4     1     0      8   150000      NA   11091   740000    784220   934220
##  7     8.30e11      8   8301    10     1     0      8        0      NA      NA   575000    587368   587368
##  8     1.34e12     13  13403    10     1     0      8    60000      NA      NA  1160000   1160000  1220000
##  9     1.41e12     14  14106     4     1     0      8   100000      NA      NA   520000    575128   675128
## 10     2.10e11      2   2101     4     1     0      8        0      NA      NA   502000    502000   502000
## # ℹ 21,634 more rows
## # ℹ 10 more variables: yoprcor &lt;dbl&gt;, yoprcorh &lt;dbl&gt;, ytrabajocor &lt;dbl&gt;, ytrabajocorh &lt;dbl&gt;,
## #   ypchautcor &lt;dbl&gt;, ypc &lt;dbl&gt;, ypchtrabajo &lt;dbl&gt;, esc &lt;dbl&gt;, educ &lt;dbl&gt;, depen &lt;dbl&gt;
```

---

## arrange: ordenación de datos

Es importante notar que `arrange()` siempre ubicará los datos perdidos (`NA`) al final. Por ejemplo:

--


```r
data_casen_csv %&gt;% arrange(edad,desc(sexo),yautcor)
```

```
## # A tibble: 21,644 × 23
##          folio region comuna  pco1  sexo  edad ecivil yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh
##          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     7.30e11      7   7301     5     2     0      8   120000   50000   50000   100000    115684   235684
##  2     1.02e12     10  10206    10     2     0      8   100000      NA   11091   341667    374940   474940
##  3     9.12e11      9   9120     4     2     0      8        0      NA      NA   400000    400000   400000
##  4     7.40e11      7   7401     4     2     0      8   280000      NA      NA  4200000   4200000  4480000
##  5     9.11e11      9   9109     4     2     0      8        0      NA   11091   320000    360641   360641
##  6     1.31e12     13  13114     4     2     0      8   600000      NA      NA  4421667   4421667  5021667
##  7     1.33e12     13  13302     4     2     0      8   250000      NA      NA   713333    713333   963333
##  8     5.10e11      5   5103    10     2     0      8   150000      NA      NA   636667    658849   808849
##  9     1.31e12     13  13127     4     2     0      8   150000      NA      NA   643333    665371   815371
## 10     9.11e11      9   9110    13     2     0      8    60000      NA      NA   540000    782565   842565
## # ℹ 21,634 more rows
## # ℹ 10 more variables: yoprcor &lt;dbl&gt;, yoprcorh &lt;dbl&gt;, ytrabajocor &lt;dbl&gt;, ytrabajocorh &lt;dbl&gt;,
## #   ypchautcor &lt;dbl&gt;, ypc &lt;dbl&gt;, ypchtrabajo &lt;dbl&gt;, esc &lt;dbl&gt;, educ &lt;dbl&gt;, depen &lt;dbl&gt;
```

---
class: inverse, center, middle

.huge[
##dplyr::select()
]

---

## select: selección de variables

La función `select()` permite reterner un sub-conjunto de las variables presentes en la base de datos.

Supongamos que sólo estamos interesados en trabajar con las variables `sexo`,`edad` y `educ`. Podemos retener sólo estas tres variables usando la función `select()`.
 
--


```r
data_casen_csv %&gt;% select(sexo,edad,educ)
```

```
## # A tibble: 21,644 × 3
##     sexo  edad  educ
##    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1     2    15     3
##  2     2    59     2
##  3     2    33     2
##  4     1    47     6
##  5     2    58     5
##  6     2     1     0
##  7     1    42     1
##  8     2    45     1
##  9     2    27     8
## 10     2    17     5
## # ℹ 21,634 more rows
```

---

## select: selección negativa de variables

Supongamos que queremos trabajar con todas las variables excepto `sexo`,`edad` y `educ`. En ese caso escribimos:

--


```r
data_casen_csv %&gt;% select(!c(sexo,edad,educ))
```

```
## # A tibble: 21,644 × 20
##            folio region comuna  pco1 ecivil yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh yoprcor
##            &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 1310510300101     13  13105    10      8   150000      NA      NA   600000    600000   750000      NA
##  2  710210140701      7   7102     2      1   250000      NA      NA   392000    439331   689331      NA
##  3 1320110300401     13  13201     1      8   150000   52500   78327    87417    146517   296517      NA
##  4 1320230021001     13  13202     1      1   900000 1508333 1508333  2791666   2791666  3691666 1500000
##  5  910330010701      9   9103     4      8    80000    1667    1667   501667    720823   800823      NA
##  6 1311310110701     13  13113    13      8        0      NA      NA   781000    781000   781000      NA
##  7  610430011401      6   6104     1      8   100000  270000  270000   270000    270000   370000  270000
##  8  830530010801      8   8305     2      1   100000      NA   44109   362500    428791   528791      NA
##  9  330110680201      3   3301     1      8   150000  433333  433333   433333    433333   583333  430000
## 10  611730032101      6   6117     4      8   200000      NA      NA  1093750   1093750  1293750      NA
## # ℹ 21,634 more rows
## # ℹ 8 more variables: yoprcorh &lt;dbl&gt;, ytrabajocor &lt;dbl&gt;, ytrabajocorh &lt;dbl&gt;, ypchautcor &lt;dbl&gt;, ypc &lt;dbl&gt;,
## #   ypchtrabajo &lt;dbl&gt;, esc &lt;dbl&gt;, depen &lt;dbl&gt;
```

---

## select: selección de variables por posición

Si quisiéramos retener las primeras cinco variables de la bases de datos, más la octava variables, podemos hacerlo del siguiente modo:

--


```r
data_casen_csv %&gt;% select(1:5,8)
```

```
## # A tibble: 21,644 × 6
##            folio region comuna  pco1  sexo yaimcorh
##            &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1 1310510300101     13  13105    10     2   150000
##  2  710210140701      7   7102     2     2   250000
##  3 1320110300401     13  13201     1     2   150000
##  4 1320230021001     13  13202     1     1   900000
##  5  910330010701      9   9103     4     2    80000
##  6 1311310110701     13  13113    13     2        0
##  7  610430011401      6   6104     1     1   100000
##  8  830530010801      8   8305     2     2   100000
##  9  330110680201      3   3301     1     2   150000
## 10  611730032101      6   6117     4     2   200000
## # ℹ 21,634 more rows
```

---

## select: selección de variables usando 'expresiones regulares'

Supongamos que sólo nos interesan las variables de ingreso. Una forma eficiente de seleccionar todas estas variables es usando el hecho de todas ellas comienzan con la letra `"y"`. La función `starts_with()` justamente implementa esta intuición:

--


```r
data_casen_csv %&gt;% select(starts_with("y"))
```

```
## # A tibble: 21,644 × 13
##    yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh yoprcor yoprcorh ytrabajocor ytrabajocorh
##       &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
##  1   150000      NA      NA   600000    600000   750000      NA       NA          NA       600000
##  2   250000      NA      NA   392000    439331   689331      NA       NA          NA       220000
##  3   150000   52500   78327    87417    146517   296517      NA       NA       52500        87417
##  4   900000 1508333 1508333  2791666   2791666  3691666 1500000  1500000     1500000      1500000
##  5    80000    1667    1667   501667    720823   800823      NA       NA        1667       501667
##  6        0      NA      NA   781000    781000   781000      NA       NA          NA       781000
##  7   100000  270000  270000   270000    270000   370000  270000   270000      270000       270000
##  8   100000      NA   44109   362500    428791   528791      NA       NA          NA       362500
##  9   150000  433333  433333   433333    433333   583333  430000   430000      433333       433333
## 10   200000      NA      NA  1093750   1093750  1293750      NA       NA          NA      1093750
## # ℹ 21,634 more rows
## # ℹ 3 more variables: ypchautcor &lt;dbl&gt;, ypc &lt;dbl&gt;, ypchtrabajo &lt;dbl&gt;
```

---

## select: selección de variables

Hay muchas otras herramientas para facilitar la selección de variables. Algunos ejemplos:

--
Selecciona todas las variables que terminan en `"a"`:

```r
data_casen_csv %&gt;% select(ends_with("a"))
```

--
Selecciona todas las variables que contienen en `"corr"`:


```r
data_casen_csv %&gt;% select(contains("cor"))
```

--
Selecciona un subconjunto de todas las variables del tipo `x1`, `x2`, etc. 


```r
data_casen_csv %&gt;% select((num_range("x", 10:15))
```

--

&lt;br&gt;
Para una lista completa ver: [dplyr_select]

[dplyr_select]: https://dplyr.tidyverse.org/reference/select.html


---
class: inverse, center, middle

.huge[
##dplyr::filter()
]

---

## filter: selección de variables

La función `filter()` permite reterner el sub-conjunto de observaciones que cumple con las condiciones especificadas por el usuario. 

Supongamos que sólo estamos interesados analizar los datos para mujeres. Podemos retener este sub-conjunto de filas usando la función `filter()`. 

--


```r
data_casen_csv %&gt;% filter(sexo==2)
```

```
## # A tibble: 11,281 × 23
##          folio region comuna  pco1  sexo  edad ecivil yaimcorh yautcor ytotcor yautcorh ymonecorh ytotcorh
##          &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;
##  1     1.31e12     13  13105    10     2    15      8   150000      NA      NA   600000    600000   750000
##  2     7.10e11      7   7102     2     2    59      1   250000      NA      NA   392000    439331   689331
##  3     1.32e12     13  13201     1     2    33      8   150000   52500   78327    87417    146517   296517
##  4     9.10e11      9   9103     4     2    58      8    80000    1667    1667   501667    720823   800823
##  5     1.31e12     13  13113    13     2     1      8        0      NA      NA   781000    781000   781000
##  6     8.31e11      8   8305     2     2    45      1   100000      NA   44109   362500    428791   528791
##  7     3.30e11      3   3301     1     2    27      8   150000  433333  433333   433333    433333   583333
##  8     6.12e11      6   6117     4     2    17      8   200000      NA      NA  1093750   1093750  1293750
##  9     6.30e11      6   6303     2     2    54      1   200000  270000  270000  1150000   1150000  1350000
## 10     1.31e12     13  13110    10     2     3      8   300000      NA      NA  1750000   1750000  2050000
## # ℹ 11,271 more rows
## # ℹ 10 more variables: yoprcor &lt;dbl&gt;, yoprcorh &lt;dbl&gt;, ytrabajocor &lt;dbl&gt;, ytrabajocorh &lt;dbl&gt;,
## #   ypchautcor &lt;dbl&gt;, ypc &lt;dbl&gt;, ypchtrabajo &lt;dbl&gt;, esc &lt;dbl&gt;, educ &lt;dbl&gt;, depen &lt;dbl&gt;
```

---

## filter: operadores de comparación

Podemos seleccionar observaciones usando los operadores matemáticos para evaluar igualdad/desigualdad.

--

* Igualdad: datos para la séptima región 


```r
  data_casen_csv %&gt;% filter(region==7)
```

--

* Negación (o complemento): todas las regiones excepto la séptima


```r
  data_casen_csv %&gt;% filter(region!=7)
```

--

* Desigualdad: todas las regiones al sur(*)  de la séptima


```r
  data_casen_csv %&gt;% filter(region&gt;7)
```

--

* Desigualdad: todas las regiones al norte(*) de la séptima, séptima incluida


```r
  data_casen_csv %&gt;% filter(region&lt;=7)
```

---

## filter: operadores lógicos

También podemos combinar instrucciones usando operaciones lógicas.

&lt;br&gt;

--

* **AND**: Para retener sólo observaciones correspondientes a mujeres mayores de edad usamos el siguiente filtro:


```r
  data_casen_csv %&gt;% filter(sexo==2 &amp; edad&gt;=18)
```

--

* **OR**: para retener sólo observaciones correspondientes a mujeres mayores de edad que viven en la 2da o en la 6ta región escribimos:


```r
  data_casen_csv %&gt;% filter(sexo==2 &amp; edad&gt;=18 &amp; (region==2 | region==6) )
```

*Nota*: El orden de los paréntesis es fundamental cuando se usa el operador **OR**.

---

## filter: operadores lógicos `xor` 

Al usar el operador lógico **OR** con condiciones que son mutuamente excluyentes tenemos dos posibilidades:

--

&lt;br&gt;

.pull-left[
Incluir todos los casos que satisfacen *al menos* una de las dos condiciones:

```r
  data_casen_csv %&gt;% 
* filter(sexo==2 | region==13) %&gt;%
  select(sexo, region) %&gt;% head()
```

```
## # A tibble: 6 × 2
##    sexo region
##   &lt;dbl&gt;  &lt;dbl&gt;
## 1     2     13
## 2     2      7
## 3     2     13
## 4     1     13
## 5     2      9
## 6     2     13
```
]

--

.pull-right[
Incluir todos los casos que satisfacen *a lo más* una de las dos condiciones:

```r
  data_casen_csv %&gt;% 
* filter(xor(sexo==2, region==13)) %&gt;%
  select(sexo, region) %&gt;% head()
```

```
## # A tibble: 6 × 2
##    sexo region
##   &lt;dbl&gt;  &lt;dbl&gt;
## 1     2      7
## 2     1     13
## 3     2      9
## 4     2      8
## 5     2      3
## 6     2      6
```
]

---
## filter: operadores lógicos

![dplyr](images/logic_operations.png)

---

## En la próxima clase ... 

- Creación y transformación de datos con `dplyr`

- Manipulación de datos agrupados con `dplyr`

- Resumen de datos con `dplyr`

---

class: fullscreen,left, top, top, text-azzurro
background-image: url("images/bicicleta.jpg")

.huge[#R se aprende]
.huge[#usando y]
.huge[#preguntando]

---

![](images/stack-exchange-search.png)

---
class: inverse, middle

Presentación y código en GitHub: &lt;https://github.com/mebucca/dar_soc4001&gt;

---
class: inverse, center, middle


##Gracias!

&lt;br&gt;
Mauricio Bucca &lt;br&gt;
https://mebucca.github.io/ &lt;br&gt;
github.com/mebucca





    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": true,
"slideNumberFormat": "%current%"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
